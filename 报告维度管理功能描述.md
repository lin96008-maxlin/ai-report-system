# 报告维度管理功能描述

## 概述

报告维度管理模块旨在提供一个灵活、可配置的框架，用于定义和管理智能报告的各个组成部分（即“维度”或“章节”）。通过该模块，用户可以创建、编辑和组织不同层级的报告内容模板，这些模板将作为构建最终报告的基础单元。AI编码软件应能够根据以下详细描述，自动生成相应的前端界面、后端逻辑和数据模型。

## 3.1 一级页面：维度管理

### 页面功能

维度管理一级页面是所有已维护维度的集中展示和管理界面。它提供了一个直观的视图，允许用户浏览、查询、新增和批量操作维度。

### 页面布局与元素

1.  **内容区域 - 左侧目录树**：
    *   **功能**：用于管理维度的分类。用户可以创建、编辑、删除和查询不同类别的维度，例如“整体分析相关”、“处置单位分析相关”、“问题类型分析相关”等。
    *   **层级**：支持多级目录结构，最顶层目录固定为“所有维度”。
    *   **默认行为**：进入该页面时，默认选中“所有维度”分组，并展示所有维度卡片。
    *   **操作**：
        *   **新增类别**：允许用户添加新的维度分类。
        *   **编辑类别**：允许用户修改现有维度分类的名称。
        *   **删除类别**：允许用户删除现有维度分类。删除时需考虑关联维度处理逻辑（例如，是否允许删除有子维度的类别，或将子维度移动到其他类别）。
        *   **查询类别**：支持按类别名称进行搜索。

2.  **内容区域 - 查询条件**：
    *   **功能**：提供过滤和搜索维度卡片的条件。
    *   **查询字段**：
        *   **维度名称**：文本输入框，支持模糊查询。
        *   **维度描述**：文本输入框，支持模糊查询。
        *   **创建时间**：日期范围选择器，允许选择开始日期和结束日期。
        *   **创建人**：文本输入框或下拉选择器（若用户量大，建议为文本输入框并支持模糊查询）。
    *   **操作**：
        *   **查询按钮**：根据输入的条件筛选维度卡片列表。
        *   **重置按钮**：清空所有查询条件。

3.  **内容区域 - 操作栏**：
    *   **功能**：提供对维度卡片列表的整体操作。
    *   **操作按钮**：
        *   **新增维度**：点击后跳转至“新增/编辑维度”二级页面，用于创建新的维度。
        *   **批量删除**：当有维度卡片被选中时可用。点击后弹出确认框，确认后批量删除选中的维度。删除时需考虑权限和关联性检查。

4.  **维度卡片列表**：
    *   **布局**：采用多列布局，例如网格布局，每行显示2-4个卡片，以提高信息密度和视觉效果。
    *   **卡片信息**：每个维度卡片应清晰展示以下信息：
        *   **序号**：维度在列表中的顺序编号。
        *   **维度名称**：维度的标题，清晰标识其内容。
        *   **维度描述**：对维度的简要说明。
        *   **所属目录**：该维度所属的分类目录，显示完整的目录路径（例如：“整体分析/概述”）。
        *   **创建时间**：维度的创建日期和时间。
        *   **创建人**：创建该维度的用户。

5.  **维度卡片操作**：
    *   **功能**：提供对单个维度卡片的快捷操作。
    *   **操作元素**：
        *   **复选框**：位于卡片左上角或右上角，用于选中该维度进行批量操作。
        *   **编辑按钮/图标**：点击后跳转至“新增/编辑维度”二级页面，并加载当前维度的内容进行编辑。
        *   **删除按钮/图标**：点击后弹出确认框，确认后删除当前维度。删除时需考虑权限和关联性检查（例如，若维度已被报告模板引用，是否允许删除或给出提示）。

### 数据模型（一级页面）

AI编码软件应能识别并生成以下数据模型，用于支持维度管理一级页面的数据存储和交互：

*   **维度分类表 (DimensionCategory)**：
    *   `id` (Primary Key, UUID/Int)
    *   `name` (String, Unique, Not Null) - 类别名称
    *   `parent_id` (Foreign Key, UUID/Int, Nullable) - 父类别ID，用于支持多级目录
    *   `description` (String, Nullable) - 类别描述
    *   `created_at` (Timestamp, Not Null)
    *   `created_by` (String, Not Null) - 创建人用户ID或名称
    *   `updated_at` (Timestamp, Nullable)
    *   `updated_by` (String, Nullable)

*   **维度表 (Dimension)**：
    *   `id` (Primary Key, UUID/Int)
    *   `name` (String, Not Null) - 维度名称
    *   `description` (String, Nullable) - 维度描述
    *   `category_id` (Foreign Key, UUID/Int, Not Null) - 所属维度分类ID
    *   `content_structure` (JSON/Text, Not Null) - 存储维度的层级内容结构（例如，一个JSON对象，包含一级、二级、三级内容的嵌套结构，以及章节标题、内容等信息）。
    *   `created_at` (Timestamp, Not Null)
    *   `created_by` (String, Not Null)
    *   `updated_at` (Timestamp, Nullable)
    *   `updated_by` (String, Nullable)

## 3.2 二级页面（非弹窗）：新增/编辑维度

### 页面功能

新增/编辑维度页面允许用户自由编辑单个维度的详细内容。一个维度可以包含多个层级的内容，最多支持三级嵌套，以适应从最末级报告段落到完整报告章节的复杂性。

### 页面布局与元素

1.  **左侧操作栏**：
    *   **功能**：提供新增一级内容的入口。
    *   **操作**：
        *   **新增一级内容按钮**：点击后触发三级弹窗“新增/编辑一级内容/子内容”，用于创建维度中的第一个层级内容。

2.  **左侧内容树形卡片**：
    *   **功能**：以树状结构展示维度内部的多级内容。每个卡片代表一个章节或段落，共同构成一个完整的维度。
    *   **结构**：
        *   **一级卡片**：代表维度中的一级内容。
        *   **二级卡片**：代表一级内容下的子内容。
        *   **三级卡片**：代表二级内容下的子内容（即一个一级内容下，最多到三级内容）。
    *   **卡片内容**：
        *   **章节标题**：显示该层级内容的标题。
        *   **章节内容**：显示该层级内容的简要描述或部分文本（完整内容在三级弹窗中编辑）。
    *   **卡片操作**：
        *   **编辑**：点击后触发三级弹窗“新增/编辑一级内容/子内容”，加载当前卡片的内容进行编辑。
        *   **新增子内容**：仅在一级和二级卡片上显示。点击后触发三级弹窗，用于在该卡片下新增子内容。
        *   **拖拽移动改变顺序**：支持在同级内容之间进行拖拽，改变内容的显示顺序。也支持将子内容拖拽到其他父内容下（层级关系需保持）。
        *   **删除**：点击后弹出确认框，确认后删除当前卡片及其所有子内容。删除时需考虑权限。

3.  **右侧预览区域**：
    *   **功能**：实时预览当前已配置维度的内容在实际报告中的效果，并支持通过简单的过滤条件进行数据填充预览。
    *   **默认状态**：默认收起，点击“展开预览”按钮后展开。
    *   **预览控制**：
        *   **过滤条件**：
            *   **上报时间**：日期范围选择器。
            *   **诉求来源**：下拉选择器（例如：微信、电话、网络等）。
            *   **所属区域**：下拉选择器（例如：市辖区、县、乡镇等）。
            *   **诉求事项**：下拉选择器（例如：环境污染、交通拥堵、噪音扰民等）。
        *   **生成预览按钮**：点击后，系统根据当前维度内容结构和过滤条件，调用后端接口，填充真实数据，并在下方展示预览内容。预览内容应模拟最终报告的排版和样式。
    *   **预览内容**：展示填充数据后的维度内容，包括章节标题、文本、以及数据占位符被替换后的实际数值。

### 数据模型（二级页面）

AI编码软件应能识别并生成以下数据模型，用于支持新增/编辑维度页面的数据存储和交互。这些数据将存储在`Dimension`表的`content_structure`字段中。

*   **维度内容结构 (DimensionContentStructure)**：
    *   这是一个嵌套的JSON结构，代表维度的层级内容。
    *   **一级内容 (Level1Content)**：
        *   `id` (UUID/Int) - 内容唯一标识
        *   `title` (String, Not Null) - 章节标题
        *   `content` (Text, Not Null) - 章节详细内容（包含数据指标占位符）
        *   `order` (Int, Not Null) - 显示顺序
        *   `children` (Array of Level2Content) - 子内容列表
    *   **二级内容 (Level2Content)**：
        *   `id` (UUID/Int)
        *   `title` (String, Not Null)
        *   `content` (Text, Not Null)
        *   `order` (Int, Not Null)
        *   `children` (Array of Level3Content) - 子内容列表
    *   **三级内容 (Level3Content)**：
        *   `id` (UUID/Int)
        *   `title` (String, Not Null)
        *   `content` (Text, Not Null)
        *   `order` (Int, Not Null)

## 3.3 三级弹窗：新增/编辑一级内容/子内容

### 页面功能

该弹窗用于配置维度模板中单个章节或段落的详细内容，特别是结合了OnlyOffice富文本编辑能力和数据指标插入功能。它允许用户定义章节标题、编写内容，并插入动态数据占位符，同时配置与该内容关联的工单过滤条件。

### 页面布局与元素

1.  **顶部 - 基本信息**：
    *   **功能**：配置当前章节的基本属性。
    *   **字段**：
        *   **章节标题**：文本输入框，必填项。用于标识当前章节的名称。
        *   **内容描述**：文本输入框，可选。对当前章节内容的简要说明。

2.  **左侧 - 内容编辑区域**：
    *   **功能**：提供富文本编辑能力，用于编写章节的详细内容，并支持插入数据指标占位符。
    *   **布局**：占据弹窗的较大面积，提供宽敞的编辑空间。
    *   **核心组件**：
        *   **OnlyOffice富文本编辑器**：集成OnlyOffice编辑器的核心功能，支持文本格式、图片、表格等富文本编辑能力。
        *   **数据指标列表**：位于编辑区域左侧或上方，展示城市治理领域预设的数据指标列表。这些指标是系统内置的，用户无需关注其来源。
        *   **指标插入功能**：用户点击数据指标列表中的某个指标时，该指标的占位符（例如：`{{工单总量}}`、`{{满意度}}`）应自动插入到OnlyOffice编辑器中当前光标所在位置。这些占位符在最终生成报告或维度预览时，将被替换为真实数据。

3.  **右侧 - 关联工单配置区域**：
    *   **功能**：允许用户配置与当前章节内容关联的工单过滤条件。这些条件将在最终生成报告时，用于将相关工单数据绑定到对应内容，方便用户反查。
    *   **布局**：占据弹窗的较小面积。
    *   **过滤条件**：
        *   **上报时间**：日期范围选择器。
        *   **诉求来源**：下拉选择器。
        *   **所属区域**：下拉选择器。
        *   **诉求事项**：下拉选择器。
        *   **诉求标签**：多选下拉选择器或标签输入框，支持用户自定义标签或从预设标签中选择。

### 数据模型（三级弹窗）

AI编码软件应能识别并生成以下数据模型，用于支持三级弹窗的数据存储和交互。这些数据将作为`DimensionContentStructure`中每个层级内容（Level1Content, Level2Content, Level3Content）的属性。

*   **章节内容 (ChapterContent)**：
    *   `title` (String, Not Null) - 章节标题
    *   `description` (String, Nullable) - 内容描述
    *   `rich_text_content` (Text, Not Null) - OnlyOffice编辑器生成的富文本内容（HTML或OnlyOffice特定格式），包含数据指标占位符。
    *   `associated_work_order_filters` (JSON, Nullable) - 关联工单的过滤条件，例如：
        ```json
        {
            "report_time_start": "2023-01-01",
            "report_time_end": "2023-01-31",
            "appeal_source": ["微信", "电话"],
            "region": ["市辖区A"],
            "appeal_item": ["环境污染"],
            "appeal_tags": ["垃圾分类", "噪音污染"]
        }
        ```

## 总结

以上是对“报告维度管理”功能的详细描述，涵盖了从一级页面到三级弹窗的各项功能、布局和数据模型。这些信息旨在为AI编码软件提供足够清晰和全面的需求，以自动化生成智能报告管理子系统中的报告维度管理功能。

